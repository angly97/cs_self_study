# 6. SQL VS NOSQL



### 1. SQL

* RDBMS(관계형 데이터베이스 시스템)에서 데이터 관리하는 언어

  * 관계형 데이터베이스

    * 정해진 스키마에 맞는 레코드만 테이블에 저장

    * 데이터 중복을 피하기 위해 데이터를 여러 테이블로 나누어 저장

      →  데이터는 한 테이블에서 관리되고, 다른 테이블에서 이용 시 관계를 이용

      →  필요한 정보가 있는 테이블과 관계를 이루어 외래키 등으로 데이터 저장

* 장점

  * 명확하게 정의된 스키마
  * 데이터 무결성 보장
  * 관계를 통해 데이터 중복없이 한 번만 저장 가능

* 단점

  * 덜 유연
    * DB 스키마를 나중에 변경하는 것이 어려움
  * Join이 많이 발생할 수 있음
  * 수직확장만 가능
    * 즉, 어느 시점에서 성장 한계 직면할 수 있음

* 사용 경우

  * 데이터가 자주 변경되는 경우
  * 데이터 구조가 극적으로 변하지 않는 경우

* ex. MySQL

  

### 2. NOSQL

* 비관계형 DBMS의 언어

  * 비관계형 데이터베이스

    * 스키마 &  관계 없음 => 분산된 데이터 관리하는데 특화됨

      →  다른 구조의 데이터를 같은 컬렉션에 추가 가능

      →  RDB에서 여러 테이블 조인했던 것을, 조인 없이 한 문서에 저장

      →  따라서 NOSQL에는 조인 없음 & 중복 제거 없음

    * 문서(Documents) = RDB의 레코드

* 장점
  * 스키마가 없어 유연
    * 저장된 데이터를 언제든 조정하고 새로운 필드 추가 가능
  * 수직/수평 확장이 가능하여, DB가 애플리케이션에서 발생하는 모든 읽기 쓰기 요청 처리 가능
* 단점
  * 복사된 데이터가 변경되면, 관계를 맺은 여러 문서에서도 수정해야함
* 사용 경우
  * 데이터 요구사항이 명확하지 않아, 데이터 구조가 자주 변경될 경우
  * 조회는 자주하지만, 관계를 맺고있는 데이터 변경은 적은 경우
  * 대용량 데이터를 다뤄(읽기, 쓰기 처리량이 큼) DB를 수평적으로 확장하는 경우
* ex. 몽고 DB

* 특성 (CAP 이론)

  * 일관성 (Consistency)

    * 다중 클라이언트(분산된 노드)에서 같은 시간에 조회하는 데이터는 항상 동일 데이터

    * 분산된 노드 간 데이터 동기화 방법

      →   동기식

      >* 데이터 저장 결과를 응답 전에, 모든 노드에 데이터를 저장
      >* 응답 시간 느리지만 데이터 정합성 보장

      →   비동기식

      >* 메모리나 임시 파일에 기록 후, 클라이언트에 먼저 응답
      >* 그 후 특정 이벤트나 프로세스를 이용하여, 노드로 데이터 동기화
      >* 빠른 응답시간 & 쓰기 노드에 장애 발생 시 데이터 손실

  * 가용성 (Availability, 내고장성)

    * 모든 클라이언트의 읽기 쓰기 요청이 항상 응답 가능해야함

    * 클러스터 내 몇 개의 노드가 망가져도 정상 서비스 가능

    * 데이터 복제(Replication) 로 보장 (데이터 중복 저장 방법)

      →   Master-Slave

      >동일 데이터 가진 저장소를 하나 더 생성

      →   Peer-To-Peer

      > 데이터 단위로 중복 저장

  * 네트워크 분할 허용성(Partition Tolerance)

    * 클러스터링 노드 간 네트워크 장애가 발생해도 정상 서비스 수행

* 저장방식에 따른 분류

  * Key-Value Model
    * 키-값으로 데이터 저장하는 단순 저장 구조
    * 단순 저장구조로 인해 복잡한 조회 연산 지원 X (부등호 같은?)
    * 웹 서버 클러스터를 위한 세션정보, URL 단축 정보 등 저장에 사용
    * 한 서비스 요청에서, 다수의 데이터 접근이 발생하면, 트랜잭션 처리 불가능하여 데이터 정합성 보장 불가
    *  ex. Redis
  * Document Model
    * 하나의 키 값에 하나의 구조화된 문서 저장
    * 데이터 접근 방법이 RDB와 유사
    * 키 = 문서의 ID
    * 저장된 문서는 컬렉션으로 관리하고, 문서 저장과 동시에 문서 ID에 대한 인덱스 생성
    * 인덱스로 O(1) 시간으로 문서 조회
    * B Tree 구조로 구성
    * 통계정보 저장 등에 사용
    * ex. 몽고 DB



### 3. 데이터베이스 확장

* 수직 확장(Scale Up)

  * 데이터베이스 성능을 업그레이드

  * ex. 저장장치를 업그레이드 등

  * SQL은 데이터 저장방식 때문에 수직확장만 지원

    * 수평 확장은 수직/수평 파티셔닝을 수행

      →   수직 파티셔닝

      >테이블의 몇몇 속성을 분리 => 스키마 변형이 옴

      →   수평 파티셔닝

      >레코드를 나눠서 분리 => 스키마는 유지

* 수평 확장(Scale Out)

  * 서버를 늘려 서버의 부하를 DB 전체적으로 분산
  * 한 데이터베이스에서 작동하지만 여러 호스트에서 작동
  * NoSQL은 수직/수평 확장 모두 가능