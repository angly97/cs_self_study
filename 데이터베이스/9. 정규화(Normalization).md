# 9. 정규화(Normalization)



### 1. 탄생 배경 / 필요성 / 이유

* 한 테이블에 중복된 데이터로 인해 이상(Anomaly) 발생
* 이를 해결하기 위해 정규화 과정 거침



### 2. 정규화

* 관계형 데이터베이스에서 중복을 최소화하기 위해 데이터를 구조화하는 작업

* 불만족스러운 릴레이션의 속성들을 분해하는 작업

  * 불만족스러운 릴레이션

    * 속성 간, 함수적 종속성을 판단하고 그에 해당하는 정규형을 만족하지 못하는 릴레이션

      > →  함수적 종속성 (Functional Dependency) ?
      >
      > 속성의 부분 집합 X, Y가 있을 때, X값에 따라 Y가 달라지는 경우 
      >
      > **Y는 X에 함수적 종속** 이라고 하고, **X(결정자) → Y(종속자)**로 표현
      >
      > 완전 함수적 종속 / 부분 함수적 종속 / 이행적 함수 종속

* 목적 / 장점

  * 데이터 중복 없애기 => 무결성 지킴 => 이상 방지
  * 테이블을 직관적으로 구성하여 현실세계 관계 반영
  * 테이블 확장 용이

* 단점

  * 릴레이션 분해로 인해 JOIN 증가

* 단점 해결

  * 반정규화 (De-Normalization; 비정규화)
    * 성능 향상을 위해, 정규화된 엔티티를 중복/통합/분리 등을 수행

  

### 3. 정규화 과정

* 정규화 과정을 거치면 제 n 정규형을 만족하게 됨

1. 제 1 정규화 (1NF)

   * 컬럼값이 원자값

   * 조건

     * 기본키로 데이터를 고유하게 식별해야 함

     * 중복되는 속성 없어야 함 (ex. 전화번호 속성이 2개)

       ​	<img src="https://user-images.githubusercontent.com/70613905/165094021-f59d89c9-8d31-4e22-9f1f-51ef63f9a422.png" alt="1정규화" style="width:67%;" />

2. 제 2 정규화 (2NF)

   * 모든 컬럼이 **완전 함수적 종속성**을 만족

     * 완전 함수적 종속

       →   부분 함수적 종속 제거

       →   기본키의 부분집합이 다른 컬럼을 결정지으면 안됨

   * 예시

     * Manufacturer → Manufacturer Country 임<img src="https://user-images.githubusercontent.com/70613905/165103411-71c1c900-f865-4ef4-9d4b-b48c0b61c09e.JPG" alt="image-20220425222117318" style="width:80%;" />

     * Manufacturer +  Country 와  Manufacturer + Model + Model Full Name으로 분리

3. 제 3 정규화 (3NF)

   * 2NF가 진행된 테이블에서 이행적 종속 제거하기 위해 테이블 분리

     * 이행적 종속

       > A → B, B → C 일 때, A → C 

   * 조건

     * 릴레이션이 2NF 만족 & 기본키 아닌 속성들은 기본키에 의존

   * 예시

     * Tournament + Year → Winner → Birth 

       ​	<img src="https://user-images.githubusercontent.com/70613905/165103481-ec1114a9-63e0-40e8-9c02-78426df8fec5.JPG" alt="image-20220425223322029" style="width:80%;" />

     * Tournament + Year + Winner 와 Winner + Birth 로 분리

4. BCNF(Bouce-Codd) 정규형

   * 제 3정규형을 강화한 형태로, 모든 결정자는 후보키

   * 예시

     * (학번, 과목명) 이 기본키	

       ​	<img src="https://user-images.githubusercontent.com/70613905/165103326-82910d06-1190-4a41-a514-5a6bccadcdb1.png" alt="BCNF" style="width:80%;" />

       * (학번, 과목명) → 담당교수,
         (학번, 담당교수)  →  과목명,
         (담당교수)  → 과목명
       * 담당교수는 후보기가 아닌데, 결정자임 => BCNF 위반
   
     * 학번 + 담당교수 와 담당교수 + 과목명으로 분리



### 4. 반정규화 (De-Normalization; 비정규화)

* 정규화된 엔티티를 성능 향상을 위해, 중복/통합/분리 등을 수행
* 필요한 경우
  * 테이블 간 경로가 멀어 Join이 많은 경우
    * 테이블 병합
  * 특정 범위 데이터만 자주 처리하는 경우 
    * 테이블을 수직분할 / 수평분할 하여 새로운 테이블 생성
  * 요약/집계 정보가 자주 요구되는 경우 (컬럼으로 계산하여 조회하는 경우 잦을 때)
    * 총 판매액, 평균 금액 등의 결과를 특정 컬럼을 추가하여 저장

* 단점 / 주의할 점
  * 과도하게 반정규화하면, 데이터 무결성 깨질 수 있고 입력/수정/삭제 등의 응답시간이 늦어질 수 있음
