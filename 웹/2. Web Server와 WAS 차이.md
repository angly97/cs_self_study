# 2.  Web Server와 WAS 차이



### 1. 정적(Static) 페이지 VS 동적(Dynamic) 페이지

* 정적 페이지

  * 바뀌지 않는 페이지
  
  * image, html, css, javascript 같이 컴퓨터에 저장된 파일

* 동적 페이지

  * 인자에 맞게 동적으로 내용 반환

  * 웹 서버가 실행하는 프로그램을 통해 만들어지 결과물



### 2. 웹 서버 VS WAS

* 웹 서버

  * 개념

    * 하드웨어

      →   web 서버가 설치된 컴퓨터

    * 소프트웨어

      →   클라이언트로부터 HTTP 요청을 받고, html, css같은 정적인 컨텐츠를 제공하는 프로그램

  * 기능

    * HTTP 프로토콜 기반으로, 클라이언트 요청을 서비스

    * 요청에 맞게 2가지 기능 중 선택해서 제공

      →   정적 컨텐츠 제공

      →   동적 컨텐츠를 제공하기 위해 요청을 전달 

      ​	ㆍ 클라이언트 요청을 WAS에 보내고, WAS에서 처리한 결과를 클라이언트에 전달

  * 종류
  
    * 아파치 등

* WAS (Web Application Server) 

  * DB 조회나 다양한 로직 처리가 요구될 때, 동적인 컨텐츠를 제공하기 위한 애플리케이션 서버

  * 웹 컨테이너, 서블릿 컨테이너라고도 불림

    * 컨테이너

      →   동적인 데이터를 처리해서 정적인 페이지를 생성하는 SW 모듈

      →   JSP, Servlet을 실행할 수 있는 SW

      →   즉, JSP, Servlet 구동 환경 제공

      →   cf. JSP
      
      > HTML내에 자바 코드를 삽입하여 웹 서버에서 동적으로 웹 페이지를 생성하여 웹 브라우저에 돌려주는 서버 사이드 스크립트 언어이다. Java EE 스펙 중 일부로 웹 애플리케이션 서버에서 동작한다.
      > 자바 서버 페이지는 실행시에는 자바 서블릿으로 변환된 후 실행되므로 서블릿과 거의 유사하다고 볼 수 있다. 하지만, 서블릿과는 달리 HTML 표준에 따라 작성되므로 웹 디자인하기에 편리하다.
      
    * 서블릿(Servlet)

      →   클라이언트 요청에 맞는 동적 페이지(html)를 응답하는 웹 어플리케이션

      →   html로 응답 & 자바 스레드 이용하여 동작 & MVC패턴의 Conroller 역할

  * 역할

    * 웹 서버 + 웹 컨테이너
  
      →   웹 서비 기능들을 구조적으로 분리하여 처리하는 역할

  * 기능

    * 프로그램 실행 환경 및 DB 접속 
    * 여러 트랜잭션 관리
    * 업무 처리하는 비즈니스 로직 수행
  
  * 종류
  
    * 톰켓, JBoss 등
  



### 3. 웹 서버와 WAS를 구분하는 이유

* 웹 서버가 필요한 이유

  * 애플리케이션 서버까지 가지 않고, 웹 서버에서 정적 컨텐츠만 처리하도록 기능을 분배하여 서버 부담 감소 & 빠르게 전송
  * 과정
    * 클라이언트 이미지 파일(정적 컨텐츠)를 보내거나
    * 웹 문서(html)이 클라이언트로 보내질 경우, 이미지 파일 같은 정적 파일은 함께 보내지지 않음
    * 먼저 html 문서를 받고, 이에 필요한 이미지 파일들을 다시 서버에 요청하여 받아옴

* WAS 가 필요한 이유

  * 요청에 맞는 데이터를 DB에서 가져와, 비즈니스 로직에 맞게 결과를 제공 가능
  * 과정
    * 동적인 컨텐츠 제공해야할 때, 웹 서버만으로 사용자가 원하는 응답을 미리 만들어놓고 서비스하기에는 자원 부족
    * 따라서 WAS를 통해 요청이 들어올 때마다 DB와 비즈니스 로직을 통해 결과물 만들어 제공

* 구분하는 이유

  * WAS는 DB조회, 로직 처리하는 데 집중해야 함
  * 따라서 단순 정적 컨텐츠는 웹 서버에게 맡겨 기능 분리 => 서버 부하 감소
  * 만약, WAS가 정적 컨텐츠 요청까지 처리하면, 동적 컨텐츠 수행이 느려짐

* 가장 효율적인 방법

  * 웹 서버를 WAS앞에 두고, 필요한 WAS 를 웹 서버에 플러그인 형태로 설정하여 효율적인 분산 처리

  * 과정

    ​	<img src="https://user-images.githubusercontent.com/70613905/166141716-26cbe928-18de-40d9-80d2-1882db0c55c4.JPG" alt="image-20220501191743783" style="zoom:80%;" />

    1. 클라이언트가 URI입력하면 HTTP Request가 웹 서버로 전송되고 WAS에게 보냄
    2. WAS web.xml기반으로 요청한 URI가 어느 Servlet에 대한 요청인지 찾음
    3. WAS는 관련된 Servlet을 메모리에 올림 & 해당 Servlet에 대한 스레드 생성 
    4. 이때 HttpServletRequest, HttpServletResponse 객체 생성하여 Servlet에 전달
    5. 해당 Servlet에서 클라이언트의 GET, POST 여부에 따라 doGet(), doPost()를 호출
    6. 메소드는 동적 페이지 생성 후, Response객체에 담아 WAS에게 전달
    7. WAS는 Response객체를 HttpServletResponse객체로 바꿔 웹 서버로 전달
    8. 응답이 끝나면 두 객체 모두 소멸 시킴
